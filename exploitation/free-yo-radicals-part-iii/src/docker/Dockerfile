FROM ubuntu:16.04

RUN apt update && apt install -y build-essential gdbserver

RUN useradd -m chal

#COPY ./free_yo_self /root/free_yo_self
COPY ./main.c /root/main.c
COPY ./flag /home/chal/flag

WORKDIR /root

RUN gcc -fpic -pie -fPIE -fstack-protector-all -D_FORTIFY_SOURCE=2 -Wl,-z,now -Wl,-z,relro main.c -o free_yo_self

RUN cp /root/free_yo_self /home/chal/free_yo_self && chmod 755 /home/chal/free_yo_self

EXPOSE 9999

USER chal
WORKDIR /home/chal
CMD ["/home/chal/free_yo_self"]
